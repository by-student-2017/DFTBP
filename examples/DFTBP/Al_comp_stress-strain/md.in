#Input example Generated by GS JUNG@ornl 
# --------------------------------------------------------------------
# Input file for uniaxial compressive loading of single crystal aluminum
# Mark Tschopp, November 2010

# ------------------------ INITIALIZATION ----------------------------
units           metal
dimension       3
boundary        p p p 

atom_style      full
atom_modify     sort 0 0.0    # turn off sorting of the coordinates

# ----------------------- ATOM DEFINITION ----------------------------
#variable latparam equal 4.05

#lattice         fcc ${latparam}
#region          whole block 0 3 0 3 0 3
#create_box      1 whole

#region          upper block INF INF INF INF INF INF units box 
#lattice         fcc ${latparam} orient x 1 0 0 orient y 0 1 0 orient z 0 0 1
#create_atoms    1 region upper

#set             region upper type/fraction 1 1.0 12393
#set             type 1 charge 0.0
#mass            1 26.98

#write_data      structure.data
# Please note that if you use the comment in the first line output by 
# "write_data" as is, the calculation will not run. It is no good if the cell size is too large. 
# It is best to make it about 3x3x3. This size makes SQS suitable for experiments.

# ----------------------- Read Structure file ------------------------
read_data       structure.data

variable        elems string "Al"

# ------------------------ initialize system -------------------------

variable         Td equal 77.0 # [K]

velocity        all create ${Td} 87287 loop geom

# ------------------------ FORCE FIELDS ------------------------------
pair_style      zero 1.0
pair_coeff      * *

fix             f2 all dftbp dftb_in.hsd NULL
fix_modify      f2 energy yes

# ------------------------- SETTINGS ---------------------------------
neighbor        2.0 bin
neigh_modify    every 1 delay 0 check yes

timestep        0.002 # 2 [fs]

compute csym all centro/atom fcc

######################################
# MINIMIZATION

#thermo          10
#thermo_style    custom step temp ke pe press pxx pyy pzz xlo xhi ylo yhi 
#thermo_modify   norm no flush yes

#dump            minimal all xyz 10 minimal.xyz
#dump_modify     minimal element ${elems}

#fix             emin all box/relax x 0.0 y 0.0 z 0.0
#min_style       cg
#min_modify      dmax 0.2
#min_modify      line quadratic
#minimize        0.0 1.0e-6 1000 10000
#unfix           emin

#undump          minimal

######################################
# EQUILIBRATION

#reset_timestep  0

#velocity        all create ${Td} 12345 mom yes rot no
#fix             f3 all npt temp ${Td} ${Td} $(100*dt) iso 0.0 0.0 $(1000*dt) drag 1 

## Set thermo output
#thermo          10
#thermo_style    custom step lx ly lz press pxx pyy pzz pe temp

#dump            d1 all cfg 10 cfg/dump.equil_*.cfg mass type xs ys zs c_csym fx fy fz
#dump_modify     d1 element ${elems}

#run             200
#unfix           f3
#undump          d1

# Store final cell length for strain calculations
variable        tmp equal "lx"
variable        L0 equal ${tmp}
print           "Initial Length, L0: ${L0}"

######################################
# DEFORMATION
reset_timestep  0

fix             f3 all npt temp ${Td} ${Td} $(100.0*dt) y 0.0 0.0 $(1000.0*dt) z 0.0 0.0 $(1000.0*dt) drag 1
variable        srate equal 1.0e10
variable        srate1 equal "-v_srate / 1.0e12"
fix             f4 all deform 1 x erate ${srate1} units box remap x

# Output strain and stress info to file
# for units metal, pressure is in [bars] = 100 [kPa] = 1/10000 [GPa]
# p2, p3, p4 are in GPa
variable strain equal "(lx - v_L0)/v_L0"
variable p1 equal "v_strain"
variable p2 equal "-pxx/10000"
variable p3 equal "-pyy/10000"
variable p4 equal "-pzz/10000"
fix def1 all print 10 "${p1} ${p2} ${p3} ${p4}" file Al_comp_100.def1.txt screen no

# Use cfg for AtomEye
dump            d2 all cfg 10 cfg/dump.comp_*.cfg mass type xs ys zs c_csym fx fy fz
dump_modify     d2 element ${elems}

# Display thermo
thermo          10
thermo_style    custom step v_strain temp v_p2 v_p3 v_p4 ke pe press

run             2000

######################################
# SIMULATION DONE
print "All done"

######################################
# Note
print "The rapid change in stress above a certain strain is due to the introduction of large deformations such as dislocations into the system."
