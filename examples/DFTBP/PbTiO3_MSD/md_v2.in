#Input example Generated by GS JUNG@ornl 
# --------------------------------------------------------------------
# Input file for uniaxial compressive loading of single crystal aluminum
# Mark Tschopp, November 2010

# ------------------------ INITIALIZATION ----------------------------
units           metal
dimension       3
boundary        p p p 

atom_style      full
atom_modify     sort 0 0.0    # turn off sorting of the coordinates

# ----------------------- Read Structure file ------------------------
read_data       structure.data

variable        elems string "Ti Pb O"
group           Ti type 1
group           Pb type 2
group           O  type 3

variable        Td equal 273.0 # [K]

# ------------------------ initialize system -------------------------

velocity        all create ${Td} 87287 loop geom

variable        kb  equal 8.61733262e-5 # [eV/K]
variable        kbT equal ${kb}*${Td} # [eV]
variable        p0  equal atoms*${kbT}/vol*(160.21766208*10000.0)
print "p0 = ${p0} [bar] (The 1st term of equation P = N*kb*T/V + ...)"
# https://docs.lammps.org/compute_pressure.html

# ------------------------ FORCE FIELDS ------------------------------
pair_style      zero 1.0
pair_coeff      * *

# ------------------------- SETTINGS ---------------------------------
neighbor        2.0 bin
neigh_modify    every 1 delay 0 check yes

variable        dt equal 0.00025 # 0.25 [fs] (same as ReaxFF)
timestep        ${dt}

dump            equil all xyz 10 equil.xyz
dump_modify     equil element ${elems}

thermo          10
thermo_style    custom step temp ke pe press pxx pyy pzz xlo xhi ylo yhi 
thermo_modify   norm no flush yes

fix             f1 all dftbp dftb_in.hsd NULL
fix_modify      f1 energy yes

######################################
# MINIMIZATION
#fix             integ all nve
#fix             therm all langevin 10.0 10.0 0.1 699483

#fix             emin all box/relax x $(v_p0/3) y $(v_p0/3) z $(v_p0/3)
#min_style       cg
#min_modify      dmax 0.2
#min_modify      line quadratic
#minimize        0.0 1.0e-4 1000 10000

#unfix           emin
#unfix           integ

######################################
# EQUILIBRATION
reset_timestep  0

#velocity        all create ${Td} 12345 mom yes rot no
fix             f2 all npt temp ${Td} ${Td} $(40.0*dt) iso ${p0} ${p0} $(100.0*dt) drag 1 

# Set thermo output
thermo          10
thermo_style    custom step lx ly lz press pxx pyy pzz pe temp

dump            d1 all cfg 10 cfg/dump.equil_*.cfg mass type xs ys zs fx fy fz
dump_modify     d1 element ${elems}

# Run for at least 10 picosecond (assuming 1 fs timestep)
run             2000
unfix           f2
undump          d1

######################################
# MSD
reset_timestep  0

compute         mymsdO O msd com yes

variable        msdoxO equal "c_mymsdO[1]"
variable        msdoyO equal "c_mymsdO[2]"
variable        msdozO equal "c_mymsdO[3]"
variable      msdototO equal "c_mymsdO[4]"

fix             msdT1 O ave/time 1 1 10 v_msdoxO v_msdoyO v_msdozO v_msdototO file msdO_300K

thermo          10
thermo_style    custom step temp ke pe press pxx pyy pzz xlo xhi ylo yhi v_msdototO

dump            d2 all cfg 10 cfg/dump.msd_*.cfg mass type xs ys zs fx fy fz
dump_modify     d2 element ${elems}

fix             f3 all nvt temp ${Td} ${Td} $(40.0*dt)

run             2000

######################################
# SIMULATION DONE
print "All done"

######################################
# Note
print "The rapid change in stress above a certain strain is due to the introduction of large deformations such as dislocations into the system."
